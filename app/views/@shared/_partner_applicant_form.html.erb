<!--[if lte IE 8]>
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
<![endif]-->
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>
<script charset="utf-8" type="text/javascript">
  function initForm($form) {
    try {
      const form = $form.get(0);
      console.log('CodeFund is initializing the form.');
      form.querySelector('input[name=referrer]').value = localStorage.getItem('utm_referrer');
      form.querySelector('input[name=referral_code]').value = '<%= referral_code %>';
      form.querySelector('input[name=utm_source]').value = localStorage.getItem('utm_source');
      form.querySelector('input[name=utm_medium]').value = localStorage.getItem('utm_medium');
      form.querySelector('input[name=utm_campaign]').value = localStorage.getItem('utm_campaign');
      form.querySelector('input[name=utm_term]').value = localStorage.getItem('utm_term');
      form.querySelector('input[name=utm_content]').value = localStorage.getItem('utm_content');
    } catch (e) {
      console.log('CodeFund was unable to initialize the form!', e.message);
    }
  }

  function injectForm() {
    if (typeof hbspt === 'undefined') return setTimeout(injectForm, 100);
    hbspt.forms.create({
      portalId: '5577891',
      formId: '<%= hubspot_form_id %>',
      onFormReady: initForm.bind(this),
    });
  }

  injectForm();
</script>
